# A Nonlocal Low Rank Model For Poisson Noise Removal

## Abstract

基于图像块的方法利用图像块之间的**冗余**和**相似性**，近年来引起广泛关注。然而，这些方法主要被限于**高斯噪声去除**。在本文中，考虑了泊松噪声去除问题，与具有**相同且独立分布的高斯噪声**不同。泊松噪声是**信号相关的**，这使问题更具有挑战性。通过结合一组具有**低秩结构先验知识**的**相似组**，并应用**最大后验估计MAP**，将泊松噪声去除问题描述为一个优化问题。然后，提出了一种**交替（alternating）极小化算法**来有效地寻找**目标函数的极小值**。通过数值实验验证了该算法的效率和有效性。

## 1. Introduction

图像去噪是图像处理领域的一项重要任务，具有广泛的应用前景。在图像采集或传输过程中，图像通常受到噪声的干扰。高斯模型是一种与图像强度无关的加性噪声模型。高斯分布具有很多方便的数学性质，已有许多方法去除高斯加性噪声。近几十年来，利用图像中*patch*之间的**冗余 redundancy**和**相似度 similarity**，基于非局部patch的去噪方法受到了广泛的关注。通常，这些方法包括三个步骤：**根据某种相似性度量来提取和匹配patch，利用patch内部的某些结构对patch进行去噪，以及*patch aggregation*来恢复干净的图像**。

在**Non-Local Means**算法中，一个给定的patch被一个相似patch的加权平均值代替。**Block Matching 3D**协同滤波将相似的块进行分布和叠加，然后再垂直方向上进行去噪处理。**Low rank minimization**（LRM）方法基于将**相似的**patch堆成一个**低秩矩阵**的思想。如果图像被噪声破坏，矩阵的*秩*会**增加**。因此，**图像去噪问题可以转化为低秩矩阵逼近问题**。由于矩阵秩最小化问题是非凸的、NP困难的，一般将最小化矩阵的**核范数**定义为矩阵奇异值的和是松弛的。一般核范数最小化方法（NNM）采用**软阈值**或**硬阈值**算子作为快速求解算子，对奇异值一视同仁。加权核范数最小化模型（WNNM），缩小了较大的奇异值而不是较小的奇异值。**基于非局部的方法主要用于去除高斯噪声**。

在计算机断层成像、核磁共振成像、电子显微镜和天文成像等成像应用中，**噪声依赖于场景亮度**，图像传感器通过计算在给定时间间隔内入射到传感器上的离散光子的数量来记录场景亮度，这遵循泊松分布。在这些应用中，噪声通常被假设为泊松分布而不是高斯噪声，泊松噪声是信号相关的，因此很难去除。

对噪声数据进行方差稳定变换（VST）后，使稳定后的数据近似服从高斯噪声，可以使用**已有的高斯噪声去除算法**来去除泊松噪声。然而，因为光强较低而导致光子计数率较低时，VST方法的性能较差。

在本文中，作者考虑了去除泊松噪声的问题，提出了一种基于**非局部patch**的**变分方法**来去除泊松噪声。在**最大后验估计MAP**的框架下，泊松噪声去除问题可以转换为一个最小化问题，其目标函数由一个**Kullback-Leibler发散项**和一个**正则化项**组成，分别对应**泊松噪声假设**和**低秩先验**。在自相似假设下，相似patch矩阵可以分解为低秩矩阵和服从高斯分布的残差矩阵的和，作者利用了这一性质，从而开发了一种有效的**交替最小化**算法来寻找目标函数的极小值的近似解。

与WNNM方法相比，作者提出的迭代方法时为了寻找给定目标函数的最小值，WNNM方法并不清楚哪个目标函数是最小化的。此外，相对于WNNM方法，LRH方法给出收敛分析证明。

本文结构如下：

- 第2节，简单阐述了**泊松噪声去除问题，即低阶矩阵逼近问题**，介绍了patch提取和恢复的算子，以及低阶逼近的思想。
- 第3节，将Poisson噪声去除问题转为最小化问题，其中将非局部相似性的先验融入到目标函数中，然后应用交替最小化方法求解该目标函数。
- 第4节，通过数值结果验证了该方法的有效性。
- 第5节，结论。

## 2. Mathematical model

### 2.1 Poisson Noise

将图像形成一个向量，第$(i, j)$个像素表示为向量的第$i + (j - 1)m$个分量，将向量$u\in R^{mn}$第$l$个分量表示为$u_l$，其中$l = i +(j-1)m， i=1, 2, \cdots, m;\ j=1,2,\cdots,n$。理想图像表示为$u$，观测到的图像$g$的像素值$g_l$是具有期望为$(u_l+b)$的泊松随机变量，其中$b$是一个标量，可以取值为0。在理想图像的值不够大时，一些记录的值可能为零，$g_l$的概率分布函数可以表示如下
$$
\begin{aligned}
P(g_j|u_l)=\frac{(u_l+b)^{g_l}}{g_l!}\cdot e^{-(u_l+b)}
\end{aligned}
$$
通常假设泊松随机变量在统计上时独立的，降解过程可以表示为
$$
\begin{aligned}
g = Poisson(u+b\cdot1)
\end{aligned}
$$
其中，$1$是一个值全为**1**的向量。**泊松噪声去除的目的是从观测到的图像$g$中恢复出理想的图像$u$**。传统上，*Richardson-Lucy*算法被广泛应用于消除泊松噪声，该方法源于最大似然法。由于RL算法采用了迭代乘法的形式，在给定一个非负初值的情况下，可以保证迭代解的非负性，RL算法的收敛速度很慢。由于泊松去噪问题的*ill-conditioning*，RL算法会在多次迭代后方法噪声。**应该采用正则化技术来稳定解**，然后通过**最小化成本函数**来确定去噪图像。该成本函数由**KL散度函数**和**表示干净图像先验的函数组成**。在该工作中，作者使用**块之间的相似性先验**，是相似块的矩阵可以分解为遵循高斯分布的低阶矩阵和残差矩阵之和。

### 2.2 Low rank matrix approximation

**低阶矩阵 Low rank matrix**问题可以表示为：给定一个矩阵$A\in R^{K \times L}$，找到秩为$r<\min\{K, L\}$的$\hat A$

，使得这两个矩阵之间的范数差最小化。
$$
\begin{aligned}
\hat A = \arg \mathop\min\limits_{rank(Z)\le r}||A-Z||^2_F
\end{aligned}
$$
在数学上，上式的**有约束优化问题**可以转换为**无约束优化问题**
$$
\begin{aligned}
\hat A = \arg\mathop\min\limits_Z\frac{1}{2}||A-Z||^2_F+\omega\cdot rank(Z)
\end{aligned}
$$
其中，$\omega$对应于低阶约束的拉格朗日乘子。当$\tau_{r+1}\le\sqrt{2\omega}\le\tau_r$，上式（3）和（4）有相同的解。

核范数最小化问题可以表述如下：
$$
\begin{aligned}
\hat A = \arg\mathop\min\limits_Z\frac{1}{2}||A-Z||^2_F+\omega\cdot ||Z||_*
\end{aligned}
$$

## 3. Low rank matrix based poission noise removal

### 3.1 Maximum a posterior estimation

作者使用MAP框架从统计学的角度描述泊松噪声去除问题，给定观测的图像$g$，其目的是恢复真实图像$u$。该估计可以由下式计算
$$
\begin{aligned}
\hat u  = \arg\mathop\min\limits_u P(u|g)
\end{aligned}
$$
通过应用**贝叶斯规则**，$u$的后验分布$P(u|g)$可以重写为$P(u|g)=P(g|u)P(u)$

假设$P_l$是从$R_l$中提出的相似patch矩阵，则矩阵$P_l$可以分解为**低秩块矩阵$X_l$**和**残差块矩阵$E_l$**之和
$$
\begin{aligned}
P_l = X_l+E_l
\end{aligned}
$$
残差矩阵的直方图可以用高斯分布来拟合

![image-20220522165100786](http://qiniu.lianghao.work/markdown/image-20220522165100786.png)

![image-20220522165247326](http://qiniu.lianghao.work/markdown/image-20220522165247326.png)

![image-20220522165309581](http://qiniu.lianghao.work/markdown/image-20220522165309581.png)

其中，$\alpha,\lambda_l$是**正则化参数**。$KL(u,g)$是衡量**预测图像**与**真实图像**之间误差的**数据拟合项**。



**注：没直接提供代码**



